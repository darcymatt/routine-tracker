<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #e9a2ea 0%, #a5b4f3 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            color: #4834d4;
            padding: 20px;
            font-size: 24px;
            font-weight: bold;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .date-time {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
        }

        .new-task-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .checkbox-group {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .task-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #4834d4;
        }

        .task-item.high-priority {
            border-left-color: #ff4757;
        }

        .task-item.medium-priority {
            border-left-color: #ffa502;
        }

        .task-item.completed {
            opacity: 0.7;
            text-decoration: line-through;
        }

        .task-details h3 {
            margin-bottom: 5px;
        }

        .task-time {
            color: #666;
            font-size: 14px;
        }

        .task-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-primary {
            background: #4834d4;
            color: white;
        }

        .btn-danger {
            background: #ff4757;
            color: white;
        }

        .missed-alert {
            background: #ff4757;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }

        .missed-alert.show {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .priority-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            color: white;
        }

        .priority-high {
            background: #ff4757;
        }

        .priority-medium {
            background: #ffa502;
        }

        .priority-low {
            background: #2ed573;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            RoutineTracker
        </div>

        <div class="date-time">
            <h2>My Tasks</h2>
            <div id="current-time"></div>
        </div>

        <div class="missed-alert" id="missed-alert">
            <span>Task Missed! Would you like to reschedule remaining tasks?</span>
            <button class="btn btn-primary" onclick="rescheduleTask()">Reschedule</button>
        </div>

        <div class="new-task-card">
            <h3>Create New Task</h3>
            <form id="task-form">
                <div class="form-group">
                    <label>Task Title</label>
                    <input type="text" id="task-title" required>
                </div>
                <div class="form-group">
                    <label>Start Time</label>
                    <input type="time" id="start-time" required>
                </div>
                <div class="form-group">
                    <label>End Time</label>
                    <input type="time" id="end-time" required>
                </div>
                <div class="form-group">
                    <label>Priority</label>
                    <select id="priority" required>
                        <option value="">Select Priority</option>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>
                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="fixed-time"> Fixed Time
                    </label>
                    <label>
                        <input type="checkbox" id="fixed-duration"> Fixed Duration
                    </label>
                </div>
                <button type="submit" class="btn btn-primary">Add Task</button>
            </form>
        </div>

        <div class="task-list" id="task-list">
            <!-- Tasks will be added here dynamically -->
        </div>
    </div>

    <script>
        let tasks = [];

        // Update current time
        function updateTime() {
            const now = new Date();
            document.getElementById('current-time').textContent = 
                now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
        }
        setInterval(updateTime, 1000);
        updateTime();

        // Add new task
        document.getElementById('task-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const task = {
                id: Date.now(),
                title: document.getElementById('task-title').value,
                startTime: document.getElementById('start-time').value,
                endTime: document.getElementById('end-time').value,
                priority: document.getElementById('priority').value,
                isFixedTime: document.getElementById('fixed-time').checked,
                isFixedDuration: document.getElementById('fixed-duration').checked,
                completed: false
            };

            tasks.push(task);
            renderTasks();
            this.reset();
        });

        // Render tasks
        function renderTasks() {
            const taskList = document.getElementById('task-list');
            taskList.innerHTML = '';

            tasks.sort((a, b) => {
                return new Date('1970/01/01 ' + a.startTime) - new Date('1970/01/01 ' + b.startTime);
            });

            tasks.forEach(task => {
                const taskElement = document.createElement('div');
                taskElement.className = `task-item ${task.completed ? 'completed' : ''} ${task.priority}-priority`;
                
                taskElement.innerHTML = `
                    <div class="task-details">
                        <h3>${task.title}</h3>
                        <div class="task-time">${task.startTime} - ${task.endTime}</div>
                    </div>
                    <div class="task-actions">
                        <span class="priority-badge priority-${task.priority}">${task.priority}</span>
                        <input type="checkbox" ${task.completed ? 'checked' : ''} 
                            onchange="toggleTask(${task.id})">
                        <button class="btn btn-danger" onclick="deleteTask(${task.id})">Delete</button>
                    </div>
                `;
                
                taskList.appendChild(taskElement);
            });

            checkMissedTasks();
        }

        // Toggle task completion
        function toggleTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                renderTasks();
            }
        }

        // Delete task
        function deleteTask(taskId) {
            tasks = tasks.filter(t => t.id !== taskId);
            renderTasks();
        }

        // Check for missed tasks
        function checkMissedTasks() {
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();

            const missedTasks = tasks.filter(task => {
                const [hours, minutes] = task.endTime.split(':');
                const taskEndTime = parseInt(hours) * 60 + parseInt(minutes);
                return !task.completed && taskEndTime < currentTime;
            });

            if (missedTasks.length > 0) {
                document.getElementById('missed-alert').classList.add('show');
            } else {
                document.getElementById('missed-alert').classList.remove('show');
            }
        }

        // Reschedule missed tasks
        function rescheduleTask() {
            const now = new Date();
            let currentHour = now.getHours();
            let currentMinute = now.getMinutes();

            tasks.forEach(task => {
                if (!task.completed) {
                    const duration = getDuration(task.startTime, task.endTime);
                    
                    // Round up to next 30-minute slot
                    currentMinute = Math.ceil(currentMinute / 30) * 30;
                    if (currentMinute >= 60) {
                        currentHour++;
                        currentMinute = 0;
                    }

                    task.startTime = formatTime(currentHour, currentMinute);
                    
                    // Calculate new end time
                    let endMinutes = currentMinute + duration;
                    let endHour = currentHour + Math.floor(endMinutes / 60);
                    endMinutes = endMinutes % 60;
                    
                    task.endTime = formatTime(endHour, endMinutes);

                    // Setup for next task
                    currentHour = endHour;
                    currentMinute = endMinutes;
                }
            });

            document.getElementById('missed-alert').classList.remove('show');
            renderTasks();
        }

        // Helper function to get duration between times in minutes
        function getDuration(start, end) {
            const [startHours, startMinutes] = start.split(':').map(Number);
            const [endHours, endMinutes] = end.split(':').map(Number);
            return (endHours * 60 + endMinutes) - (startHours * 60 + startMinutes);
        }

        // Helper function to format time
        function formatTime(hours, minutes) {
            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
        }

        // Check for missed tasks every minute
        setInterval(checkMissedTasks, 60000);
    </script>
</body>
</html>
